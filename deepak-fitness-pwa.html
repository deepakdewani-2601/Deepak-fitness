<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Deepak Fitness">
    <meta name="theme-color" content="#f97316">
    <title>Deepak Fitness</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkRlZXBhayBGaXRuZXNzIiwKICAic2hvcnRfbmFtZSI6ICJEZWVwYWsgRml0bmVzcyIsCiAgImRlc2NyaXB0aW9uIjogIlBlcnNvbmFsIGZpdG5lc3MgdHJhaW5pbmcgYW5kIHRyYWNraW5nIGFwcCIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBmMTcyYSIsCiAgInRoZW1lX2NvbG9yIjogIiNmOTczMTYiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgNTEyIDUxMicpM0UlM0NyZWN0IHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJyBmaWxsPSclMjNmOTczMTYnLyUzRSUzQ3RleHQgeD0nNTAlMjUnIHk9JzUwJTI1JyBkb21pbmFudC1iYXNlbGluZT0nbWlkZGxlJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmb250LXNpemU9JzI4MCcgZmlsbD0nd2hpdGUnIGZvbnQtZmFtaWx5PSdBcmlhbCwgc2Fucy1zZXJpZicgZm9udC13ZWlnaHQ9J2JvbGQnJTNFJUYwJTlGJTkyJUFBJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQ==">
    
    <!-- Apple Touch Icon (embedded as data URL) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23f97316'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='280' fill='white' font-family='Arial, sans-serif' font-weight='bold'%3Eüí™%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Safe area insets for iPhone notch/home indicator */
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            color: #e5e7eb;
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            /* Prevent pull-to-refresh on iOS */
            overscroll-behavior-y: contain;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 1.5rem;
            padding-top: calc(1.5rem + env(safe-area-inset-top));
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid #d4af37;
            position: sticky;
            top: 0;
            z-index: 40;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .header-title h1 {
            font-size: 1.875rem;
            font-weight: 700;
        }
        
        .header-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .icon {
            width: 2rem;
            height: 2rem;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }
        
        .heart-icon {
            animation: pulse 2s infinite;
            fill: currentColor;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* View Toggle - iOS Bottom Tab Bar Style */
        .view-toggle {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            gap: 0;
            padding: 0.5rem 1rem;
            padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid #2d2d2d;
            z-index: 45;
        }
        
        .view-btn {
            flex: 1;
            padding: 0.6rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.7rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            color: #9ca3af;
            background: transparent;
        }
        
        .view-btn.active {
            color: #d4af37;
            background: transparent;
            transform: none;
        }
        
        .view-btn:not(.active):active {
            transform: scale(0.95);
            background: rgba(45, 45, 45, 0.5);
        }
        
        .view-btn svg {
            width: 1.5rem;
            height: 1.5rem;
        }
        
        /* Day Selector */
        .day-selector {
            padding: 1rem;
            overflow-x: auto;
        }
        
        .day-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .day-btn {
            padding: 0.65rem 1.1rem;
            min-height: 44px;
            border-radius: 0.5rem;
            font-weight: 600;
            white-space: nowrap;
            border: 1px solid #404040;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #2d2d2d;
            color: #e5e7eb;
            -webkit-tap-highlight-color: transparent;
        }
        
        .day-btn.active {
            background: linear-gradient(135deg, #d4af37 0%, #c9a342 100%);
            border-color: #d4af37;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
            transform: scale(1.05);
            color: #000000;
        }
        
        .day-btn:not(.active):hover {
            background: #3d3d3d;
            border-color: #d4af37;
        }
        
        /* Content */
        .content {
            padding: 1rem;
            padding-bottom: calc(5rem + env(safe-area-inset-bottom));
        }
        
        .summary-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            margin-bottom: 1rem;
            border: 1px solid #404040;
        }
        
        .summary-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .summary-stats {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .time-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }
        
        .completion-display {
            text-align: right;
        }
        
        .completion-label {
            font-size: 0.875rem;
            color: #9ca3af;
        }
        
        .completion-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #d4af37;
        }
        
        .progress-bar {
            width: 100%;
            background: #0a0a0a;
            border-radius: 9999px;
            height: 0.75rem;
            overflow: hidden;
            border: 1px solid #2d2d2d;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #d4af37, #c9a342);
            transition: width 0.5s;
        }
        
        /* Exercise List */
        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .exercise-item {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 3px solid transparent;
            border: 1px solid #404040;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .exercise-item:hover {
            border-color: #d4af37;
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.2);
        }
        
        .exercise-item.completed {
            opacity: 0.6;
            border: 2px solid #22c55e;
        }
        
        .exercise-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }
        
        .category-icon {
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #d4af37 0%, #c9a342 100%);
        }
        
        .exercise-name {
            font-weight: 600;
            font-size: 1.125rem;
        }
        
        .exercise-category {
            font-size: 0.875rem;
            color: #9ca3af;
            text-transform: capitalize;
        }
        
        .exercise-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .duration-badge {
            background: #334155;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        
        .icon-btn {
            padding: 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-btn:hover {
            background: #334155;
        }
        
        .icon-btn.favorite.active svg {
            fill: #facc15;
            stroke: #facc15;
        }
        
        .icon-btn.delete:hover {
            background: rgba(239, 68, 68, 0.2);
        }
        
        /* iOS-Style Button Feedback */
        .add-btn:active,
        .modal-add-btn:active,
        .home-btn:active,
        .day-btn:active,
        .edit-day-btn:active,
        .category-tab:active,
        .exercise-option:active {
            transform: scale(0.97);
            transition: transform 0.1s ease;
        }
        
        .week-nav-btn:active {
            transform: scale(0.9);
            opacity: 0.7;
        }

        /* Add Button */
        .add-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #d4af37 0%, #c9a342 100%);
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1.125rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(212, 175, 55, 0.3);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: #000000;
            -webkit-tap-highlight-color: transparent;
        }
        
        .add-btn:hover {
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }
        
        .add-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 70;
            padding: 0;
        }
        
        .modal-overlay.show {
            display: flex;
            animation: fadeInOverlay 0.3s ease;
        }
        
        .modal-overlay.show .modal {
            animation: slideUp 0.3s ease;
        }
        
        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }
        
        .modal {
            background: #1a1a1a;
            border-radius: 1.5rem 1.5rem 0 0;
            width: 100%;
            max-width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid #404040;
            border-bottom: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: #1a1a1a;
            padding: 1.5rem;
            border-bottom: 1px solid #404040;
            z-index: 10;
        }
        
        .modal-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .category-tabs {
            display: flex;
            gap: 0.5rem;
        }
        
        .category-tab {
            flex: 1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-transform: capitalize;
            border: 1px solid #404040;
            cursor: pointer;
            transition: all 0.3s;
            background: #2d2d2d;
            color: #e5e7eb;
        }
        
        .category-tab:not(.active):hover {
            background: #3d3d3d;
            border-color: #d4af37;
        }
        
        .duration-input-group {
            margin-top: 1rem;
        }
        
        .duration-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .duration-input {
            width: 100%;
            background: #334155;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-size: 1.125rem;
            font-weight: 600;
            border: none;
            color: white;
        }
        
        .exercise-grid {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .exercise-grid::-webkit-scrollbar {
            display: none;
        }

        .exercise-grid {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .exercise-option {
            width: 100%;
            text-align: left;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background: #2d2d2d;
            border: 1px solid #404040;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            gap: 0.75rem;
            min-height: 96px;
            color: #e5e7eb;
        }
        
        .exercise-option:hover {
            background: #3d3d3d;
            border-color: #d4af37;
        }
        
        .exercise-option.selected {
            background: linear-gradient(135deg, #2d2d2d 0%, #3d3d3d 100%);
            border-color: #d4af37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.3);
        }
        
        .modal-footer {
            position: sticky;
            bottom: 0;
            background: #1e293b;
            padding: 1.5rem;
            border-top: 1px solid #334155;
        }
        
        .modal-add-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #d4af37 0%, #c9a342 100%);
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1.125rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(212, 175, 55, 0.3);
            transition: all 0.3s;
            color: #000000;
        }
        
        .modal-add-btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }
        
        .modal-add-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        /* Workout View */
        .workout-item {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 0.75rem;
            padding: 1.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid #404040;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .workout-item:not(.completed):hover {
            border-color: #d4af37;
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.2);
        }
        
        .workout-item.completed {
            opacity: 0.5;
            border-color: #d4af37;
        }
        
        .checkbox {
            padding: 0.75rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .checkbox:not(.checked) {
            background: #2d2d2d;
            border: 2px solid #404040;
        }
        
        .checkbox.checked {
            background: linear-gradient(135deg, #d4af37 0%, #c9a342 100%);
            border: 2px solid #d4af37;
        }
        
        .workout-info {
            flex: 1;
            text-align: left;
        }
        
        .workout-name {
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .workout-name.completed {
            text-decoration: line-through;
        }
        
        .workout-meta {
            color: #9ca3af;
            font-size: 0.875rem;
            text-transform: capitalize;
        }
        
        .completion-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            text-align: center;
            margin-top: 1rem;
            border: 1px solid #d4af37;
        }
        
        .completion-number {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #d4af37;
        }
        
        .completion-text {
            font-size: 1.125rem;
            opacity: 0.9;
        }
        
        .small-icon {
            width: 1rem;
            height: 1rem;
        }
        
        .medium-icon {
            width: 1.25rem;
            height: 1.25rem;
        }
        
        .large-icon {
            width: 1.5rem;
            height: 1.5rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #scheduleView, #workoutView {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .exercise-badges {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Weekly Schedule Modal */
        .schedule-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 60;
            padding: 1rem;
        }

        .schedule-modal.show {
            display: flex;
            animation: fadeInOverlay 0.3s ease;
        }
        
        .schedule-modal.show .schedule-modal-content {
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .schedule-modal-content {
            background: #1a1a1a;
            border-radius: 1.5rem;
            width: 100%;
            max-width: 50rem;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid #404040;
        }

        .schedule-modal-header {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 1.5rem;
            border-radius: 1.5rem 1.5rem 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #d4af37;
        }

        .schedule-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .schedule-modal-body {
            padding: 1.5rem;
        }

        .day-schedule-card {
            background: #2d2d2d;
            border-radius: 1rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 3px solid #d4af37;
            border: 1px solid #404040;
            border-left: 3px solid #d4af37;
        }

        .day-schedule-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #404040;
            gap: 1rem;
        }

        .day-schedule-name {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .day-schedule-time {
            font-size: 0.875rem;
            color: #d4af37;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .day-schedule-exercises {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .day-schedule-exercise {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 0.5rem;
        }

        .day-schedule-exercise-name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .day-schedule-exercise-duration {
            font-size: 0.875rem;
            color: #9ca3af;
        }

        .empty-day {
            color: #9ca3af;
            font-style: italic;
            padding: 0.5rem;
        }

        .day-schedule-card.editing-mode {
            border-color: #d4af37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }

        .inline-add-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, #d4af37, #c9a342);
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            color: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            transition: all 0.3s;
        }

        .inline-add-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .exercise-delete-btn {
            background: transparent;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: all 0.3s;
        }

        .exercise-delete-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .day-schedule-exercise {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem;
            background: #1e293b;
            border-radius: 0.5rem;
        }

        .edit-day-btn {
            background: linear-gradient(135deg, #d4af37, #c9a342);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            color: #000000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .edit-day-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .edit-day-btn.view-only {
            background: #2d2d2d;
            color: #9ca3af;
            border: 1px solid #404040;
        }

        .edit-day-btn.view-only:hover {
            background: #3d3d3d;
            border-color: #505050;
            transform: none;
            box-shadow: none;
        }

        .home-btn {
            background: linear-gradient(135deg, #d4af37 0%, #c9a342 100%);
            color: #000000;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1.5rem auto 0;
            box-shadow: 0 4px 16px rgba(212, 175, 55, 0.3);
            transition: all 0.3s;
        }

        .home-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .done-editing-btn {
            width: 100%;
            padding: 1rem;
            background: #2d2d2d;
            border: 1px solid #404040;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: #e5e7eb;
        }
        
        .done-editing-btn:hover {
            background: #3d3d3d;
            border-color: #d4af37;
        }

        .done-editing-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Week Selector */
        .week-selector-bar {
            background: rgba(30, 41, 59, 0.5);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .week-nav-btn {
            background: #334155;
            border: none;
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            color: white;
        }

        .week-nav-btn:hover:not(:disabled) {
            background: #475569;
        }

        .week-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .week-display {
            flex: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .week-display-main {
            font-size: 0.875rem;
            font-weight: 600;
            color: #9ca3af;
        }

        .week-display-range {
            font-size: 0.95rem;
            color: #e5e7eb;
            font-weight: 600;
        }

        .week-status-badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .week-status-past {
            background: #2d2d2d;
            color: #9ca3af;
            border: 1px solid #404040;
        }

        .week-status-current {
            background: linear-gradient(135deg, #d4af37, #c9a342);
            color: #000000;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        .week-status-future {
            background: #2d2d2d;
            color: #d4af37;
            border: 1px solid #d4af37;
        }

        .readonly-notice {
            background: linear-gradient(135deg, #475569, #334155);
            border: 2px solid #64748b;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            margin: 1rem 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14.4 14.4L9.6 9.6"></path>
                        <path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path>
                        <path d="m21.5 21.5-1.4-1.4"></path>
                        <path d="M3.9 3.9 2.5 2.5"></path>
                        <path d="M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z"></path>
                    </svg>
                    <h1>Deepak Fitness</h1>
                </div>
                <svg class="icon heart-icon" viewBox="0 0 24 24">
                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path>
                </svg>
            </div>
            <p class="header-subtitle">Transform Your Body, Elevate Your Mind</p>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="view-btn active" id="scheduleViewBtn">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Schedule</span>
            </button>
            <button class="view-btn" id="workoutViewBtn">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="m9 12 2 2 4-4"></path>
                </svg>
                <span>Workout</span>
            </button>
        </div>

        <!-- Week Selector -->
        <div class="week-selector-bar">
            <button class="week-nav-btn" id="prevWeekBtn" onclick="changeWeek(-1)">
                <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <div class="week-display">
                <div>
                    <span class="week-status-badge week-status-current" id="weekStatusBadge">This Week</span>
                </div>
                <div class="week-display-range" id="weekDisplayRange">Jan 13 - Jan 19, 2026</div>
                <div class="week-display-main" id="weekDisplayText" style="display: none;"></div>
            </div>
            <button class="week-nav-btn" id="nextWeekBtn" onclick="changeWeek(1)">
                <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
        </div>

        <!-- Day Selector -->
        <div class="day-selector">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                <div style="font-size: 0.875rem; color: #9ca3af; font-weight: 600;">SELECT DAY</div>
                <button onclick="showWeeklySchedule()" style="
                    background: linear-gradient(135deg, #d4af37, #c9a342);
                    border: none;
                    padding: 0.5rem 1rem;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    font-size: 0.875rem;
                    cursor: pointer;
                    color: #000000;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
                ">
                    <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Full Week View
                </button>
            </div>
            <div class="day-buttons" id="dayButtons"></div>
        </div>

        <!-- Schedule View -->
        <div class="content" id="scheduleView">
            <div class="summary-card">
                <h2 class="summary-header" id="dayTitle">Monday's Workout</h2>
                <div class="summary-stats">
                    <div class="time-display">
                        <svg class="medium-icon" style="stroke: #d4af37;" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="timeDisplay">0 / 60 min</span>
                    </div>
                    <div class="completion-display">
                        <div class="completion-label">Completion</div>
                        <div class="completion-value" id="completionPercent">0%</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="exercise-list" id="exerciseList"></div>

            <button class="add-btn" id="addExerciseBtn">
                <svg class="large-icon" viewBox="0 0 24 24">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Exercise
            </button>
        </div>

        <!-- Workout View -->
        <div class="content hidden" id="workoutView">
            <div class="summary-card">
                <h2 class="summary-header" id="workoutDayTitle">Monday's Workout Session</h2>
                <p style="color: #9ca3af;">Check off exercises as you complete them</p>
            </div>

            <div class="exercise-list" id="workoutList"></div>

            <div class="completion-card">
                <div class="completion-number" id="workoutCompletionPercent">0%</div>
                <div class="completion-text" id="workoutCompletionText">Keep Going!</div>
            </div>

            <button class="home-btn" style="margin: 1.5rem auto;" onclick="goToHome()">
                <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                Back to Home
            </button>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h3 class="modal-title">Add Exercises <span id="selectedCount" style="color: #d4af37; font-size: 0.9rem;"></span></h3>
                    <button class="icon-btn" id="closeModalBtn">
                        <svg class="large-icon" viewBox="0 0 24 24">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <div class="category-tabs" style="display: flex; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem;">
                    <button class="category-tab active" style="background: linear-gradient(135deg, #d4af37, #c9a342); color: #000; border-color: #d4af37; min-width: fit-content;" data-category="Favorites">‚≠ê Favorites</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Arms">Arms</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Chest">Chest</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Back">Back</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Shoulders">Shoulders</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Abs">Abs</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Legs">Legs</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Butt/Hips">Glutes</button>
                    <button class="category-tab" style="background: #2d2d2d; min-width: fit-content;" data-category="Cardio">Cardio</button>
                </div>

                <div class="duration-input-group">
                    <label class="duration-label">Duration (minutes)</label>
                    <input type="number" class="duration-input" id="durationInput" value="5" min="1" max="55">
                </div>
            </div>

            <div class="exercise-grid" id="exerciseGrid"></div>

            <div class="modal-footer">
                <button class="modal-add-btn" id="modalAddBtn" disabled>
                    <span id="addBtnText">Add to <span id="modalDayName">Monday</span></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Weekly Schedule Modal -->
    <div class="schedule-modal" id="scheduleModal">
        <div class="schedule-modal-content">
            <div class="schedule-modal-header">
                <h3 class="schedule-modal-title">üìÖ Weekly Training Schedule</h3>
                <button class="icon-btn" id="closeScheduleModalBtn">
                    <svg class="large-icon" viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Week Navigation in Modal -->
            <div class="week-selector-bar" style="background: rgba(0, 0, 0, 0.3); border-top: 1px solid #404040;">
                <button class="week-nav-btn" onclick="changeWeekInModal(-1)">
                    <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <div class="week-display">
                    <div>
                        <span class="week-status-badge week-status-current" id="modalWeekStatusBadge">This Week</span>
                    </div>
                    <div class="week-display-range" id="modalWeekDisplayRange">Jan 13 - Jan 19, 2026</div>
                </div>
                <button class="week-nav-btn" onclick="changeWeekInModal(1)">
                    <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
            
            <div class="schedule-modal-body" id="weeklyScheduleContent"></div>
            <div style="padding: 0 1.5rem 1.5rem;">
                <button class="home-btn" onclick="goToHome()">
                    <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <script>
        // Exercise Library
        // Exercise library with real images (Public Domain from free-exercise-db)
        const EXERCISE_LIBRARY = {
            'Arms': [
                { name: 'Bicep Curls', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Alternate_Incline_Dumbbell_Curl/0.jpg', muscles: 'Biceps' },
                { name: 'Hammer Curls', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Alternate_Hammer_Curl/0.jpg', muscles: 'Biceps, Forearms' },
                { name: 'Tricep Dips', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Bench_Dips/0.jpg', muscles: 'Triceps' },
                { name: 'Tricep Extensions', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Cable_Lying_Triceps_Extension/0.jpg', muscles: 'Triceps' },
                { name: 'Preacher Curls', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Cable_Preacher_Curl/0.jpg', muscles: 'Biceps' },
                { name: 'Concentration Curls', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Dumbbell_Concentration_Curls/0.jpg', muscles: 'Biceps' }
            ],
            'Chest': [
                { name: 'Bench Press', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Bench_Press_-_Medium_Grip/0.jpg', muscles: 'Chest, Triceps' },
                { name: 'Push-ups', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Pushups/0.jpg', muscles: 'Chest, Triceps, Shoulders' },
                { name: 'Incline Bench Press', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Incline_Bench_Press_Medium-Grip/0.jpg', muscles: 'Upper Chest' },
                { name: 'Chest Flyes', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Dumbbell_Flyes/0.jpg', muscles: 'Chest' },
                { name: 'Dumbbell Press', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Dumbbell_Bench_Press/0.jpg', muscles: 'Chest, Triceps' },
                { name: 'Cable Crossover', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Cable_Crossover/0.jpg', muscles: 'Chest' }
            ],
            'Back': [
                { name: 'Pull-ups', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Pullups/0.jpg', muscles: 'Lats, Biceps' },
                { name: 'Bent Over Rows', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Bent_Over_Barbell_Row/0.jpg', muscles: 'Back, Biceps' },
                { name: 'Deadlifts', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Deadlift/0.jpg', muscles: 'Full Back, Legs' },
                { name: 'Lat Pulldown', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Wide-Grip_Lat_Pulldown/0.jpg', muscles: 'Lats' },
                { name: 'Seated Cable Rows', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Seated_Cable_Rows/0.jpg', muscles: 'Middle Back' },
                { name: 'T-Bar Row', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/T-Bar_Row/0.jpg', muscles: 'Back' }
            ],
            'Shoulders': [
                { name: 'Shoulder Press', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Dumbbell_Shoulder_Press/0.jpg', muscles: 'Shoulders' },
                { name: 'Lateral Raises', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Side_Lateral_Raise/0.jpg', muscles: 'Lateral Deltoids' },
                { name: 'Front Raises', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Front_Dumbbell_Raise/0.jpg', muscles: 'Front Deltoids' },
                { name: 'Arnold Press', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Arnold_Dumbbell_Press/0.jpg', muscles: 'Shoulders' },
                { name: 'Upright Rows', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Upright_Row_-_Wide_Grip/0.jpg', muscles: 'Shoulders, Traps' },
                { name: 'Face Pulls', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Cable_Face_Pull_With_External_Rotation/0.jpg', muscles: 'Rear Delts' }
            ],
            'Abs': [
                { name: 'Crunches', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Crunches/0.jpg', muscles: 'Abs' },
                { name: 'Plank', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Front_Plank/0.jpg', muscles: 'Core' },
                { name: 'Bicycle Crunches', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Air_Bike/0.jpg', muscles: 'Abs, Obliques' },
                { name: 'Russian Twists', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Russian_Twist/0.jpg', muscles: 'Obliques' },
                { name: 'Leg Raises', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Hanging_Leg_Raise/0.jpg', muscles: 'Lower Abs' },
                { name: 'Ab Wheel', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Ab_Roller/0.jpg', muscles: 'Full Core' },
                { name: 'V-ups', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Jackknife_Sit-Up/0.jpg', muscles: 'Full Abs' },
                { name: 'Side Plank', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Side_Plank/0.jpg', muscles: 'Obliques' }
            ],
            'Legs': [
                { name: 'Squats', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Full_Squat/0.jpg', muscles: 'Quads, Glutes' },
                { name: 'Lunges', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Lunge/0.jpg', muscles: 'Quads, Glutes' },
                { name: 'Leg Press', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Leg_Press/0.jpg', muscles: 'Quads, Glutes' },
                { name: 'Leg Curls', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Lying_Leg_Curls/0.jpg', muscles: 'Hamstrings' },
                { name: 'Leg Extensions', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Leg_Extensions/0.jpg', muscles: 'Quadriceps' },
                { name: 'Calf Raises', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Standing_Calf_Raises/0.jpg', muscles: 'Calves' },
                { name: 'Romanian Deadlift', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Romanian_Deadlift/0.jpg', muscles: 'Hamstrings, Glutes' },
                { name: 'Step-ups', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Dumbbell_Step_Ups/0.jpg', muscles: 'Quads, Glutes' }
            ],
            'Butt/Hips': [
                { name: 'Hip Thrusts', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Hip_Thrust/0.jpg', muscles: 'Glutes' },
                { name: 'Glute Bridges', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Butt_Lift_(Bridge)/0.jpg', muscles: 'Glutes' },
                { name: 'Fire Hydrants', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Fire_Hydrant/0.jpg', muscles: 'Glutes, Hips' },
                { name: 'Goblet Squats', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Barbell_Squat_To_A_Bench/0.jpg', muscles: 'Glutes, Quads' }
            ],
            'Cardio': [
                { name: 'Running', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Run_-_Treadmill/0.jpg', muscles: 'Full Body' },
                { name: 'Jump Rope', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Rope_Jumping/0.jpg', muscles: 'Full Body' },
                { name: 'Burpees', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Burpee/0.jpg', muscles: 'Full Body' },
                { name: 'Jumping Jacks', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Jumping_Jacks/0.jpg', muscles: 'Full Body' },
                { name: 'High Knees', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/High_Knees/0.jpg', muscles: 'Cardio' },
                { name: 'Box Jumps', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Box_Jump_(Multiple_Response)/0.jpg', muscles: 'Legs, Cardio' },
                { name: 'Rowing', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Rowing_-_Stationary/0.jpg', muscles: 'Full Body' },
                { name: 'Cycling', img: 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/Recumbent_Bike/0.jpg', muscles: 'Legs, Cardio' }
            ]
        };

        const DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

        // State
        let schedules = {};
        let favorites = [];
        let currentDay = 'Monday';
        let currentView = 'schedule';
        let selectedCategory = 'Arms';
        let selectedExercise = '';
        let currentWeekOffset = 0; // 0 = current week, -1 = last week, 1 = next week
        let todayDate = new Date();
        let editingDayInModal = null; // Track which day is being edited in Full Week View
        let selectedExercises = []; // Array to track multiple selected exercises
        let pendingDuplicateAdd = null; // Store pending exercises for duplicate confirmation

        // Initialize
        function init() {
            loadData();
            cleanupAllSavedWeeks(); // One-time migration to remove default stretching
            setCurrentDayFromCalendar(); // Set to today's day
            updateWeekDisplay();
            renderDayButtons();
            setupEventListeners();
            updateView();
        }

        function setCurrentDayFromCalendar() {
            const today = new Date();
            const dayIndex = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            // Convert to our DAYS array format (Monday = 0)
            const dayMapping = [6, 0, 1, 2, 3, 4, 5]; // Sunday=6, Monday=0, Tuesday=1, etc.
            currentDay = DAYS[dayMapping[dayIndex]];
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust to Monday
            return new Date(d.setDate(diff));
        }

        function getWeekEnd(weekStart) {
            const end = new Date(weekStart);
            end.setDate(end.getDate() + 6);
            return end;
        }

        function formatDate(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[date.getMonth()]} ${date.getDate()}`;
        }

        function getWeekKey(offset) {
            const weekStart = getWeekStart(todayDate);
            weekStart.setDate(weekStart.getDate() + (offset * 7));
            return `week_${weekStart.getFullYear()}_${weekStart.getMonth()}_${weekStart.getDate()}`;
        }

        function getCurrentWeekSchedules() {
            const weekKey = getWeekKey(currentWeekOffset);
            const savedWeekData = localStorage.getItem(`deepakFitness_${weekKey}`);
            
            if (savedWeekData) {
                return JSON.parse(savedWeekData);
            }
            
            // If viewing current week and no saved data, return default schedules
            if (currentWeekOffset === 0) {
                return schedules;
            }
            
            // For other weeks, return all days empty (no default stretching)
            const emptyWeek = {};
            DAYS.forEach(day => {
                emptyWeek[day] = [];
            });
            return emptyWeek;
        }

        function saveCurrentWeekSchedules() {
            const weekKey = getWeekKey(currentWeekOffset);
            localStorage.setItem(`deepakFitness_${weekKey}`, JSON.stringify(schedules));
        }

        function changeWeek(direction) {
            // Save current week before changing
            saveCurrentWeekSchedules();
            
            currentWeekOffset += direction;
            
            // Load the new week's schedules
            schedules = getCurrentWeekSchedules();
            
            updateWeekDisplay();
            renderDayButtons();
            updateView();
        }

        function updateWeekDisplay() {
            const weekStart = getWeekStart(todayDate);
            weekStart.setDate(weekStart.getDate() + (currentWeekOffset * 7));
            const weekEnd = getWeekEnd(weekStart);
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const currentWeekStart = getWeekStart(today);
            currentWeekStart.setHours(0, 0, 0, 0);
            weekStart.setHours(0, 0, 0, 0);
            
            // Determine week status - compare week start dates
            let statusText = '';
            let statusClass = '';
            
            if (weekStart.getTime() === currentWeekStart.getTime()) {
                statusText = 'This Week';
                statusClass = 'week-status-current';
            } else if (weekStart < currentWeekStart) {
                const weeksAgo = Math.abs(currentWeekOffset);
                statusText = weeksAgo === 1 ? 'Last Week' : `${weeksAgo} Weeks Ago`;
                statusClass = 'week-status-past';
            } else {
                const weeksAhead = currentWeekOffset;
                statusText = weeksAhead === 1 ? 'Next Week' : `${weeksAhead} Weeks Ahead`;
                statusClass = 'week-status-future';
            }
            
            // Badge on first line (prominent)
            const badge = document.getElementById('weekStatusBadge');
            badge.textContent = statusText;
            badge.className = `week-status-badge ${statusClass}`;
            
            // Date range on second line
            document.getElementById('weekDisplayText').textContent = '';
            document.getElementById('weekDisplayRange').textContent = 
                `${formatDate(weekStart)} - ${formatDate(weekEnd)}, ${weekStart.getFullYear()}`;
        }

        function updateReadonlyNotice() {
            const notice = document.getElementById('readonlyNotice');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const currentWeekStart = getWeekStart(today);
            currentWeekStart.setHours(0, 0, 0, 0);
            
            const viewingWeekStart = getWeekStart(todayDate);
            viewingWeekStart.setDate(viewingWeekStart.getDate() + (currentWeekOffset * 7));
            viewingWeekStart.setHours(0, 0, 0, 0);
            
            // Show notice if viewing a past week (week start is before current week start)
            if (viewingWeekStart < currentWeekStart) {
                notice.classList.remove('hidden');
            } else {
                notice.classList.add('hidden');
            }
        }

        function isCurrentWeekInPast() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const currentWeekStart = getWeekStart(today);
            currentWeekStart.setHours(0, 0, 0, 0);
            
            const viewingWeekStart = getWeekStart(todayDate);
            viewingWeekStart.setDate(viewingWeekStart.getDate() + (currentWeekOffset * 7));
            viewingWeekStart.setHours(0, 0, 0, 0);
            
            return viewingWeekStart < currentWeekStart;
        }

        function isDayInPast(dayName) {
            // Get the actual date for this day in the currently viewed week
            const weekStart = getWeekStart(todayDate);
            weekStart.setDate(weekStart.getDate() + (currentWeekOffset * 7));
            
            const dayIndex = DAYS.indexOf(dayName);
            const dayDate = new Date(weekStart);
            dayDate.setDate(dayDate.getDate() + dayIndex);
            dayDate.setHours(0, 0, 0, 0);
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            return dayDate < today;
        }

        function loadData() {
            const savedFavorites = localStorage.getItem('deepakFitnessFavorites');

            // Load the current week's schedule using week-based storage
            const weekKey = getWeekKey(0); // Current week
            const savedWeekData = localStorage.getItem(`deepakFitness_${weekKey}`);
            
            if (savedWeekData) {
                schedules = JSON.parse(savedWeekData);
            } else {
                // Check if there's old data in the legacy format
                const oldSavedSchedules = localStorage.getItem('deepakFitnessSchedules');
                if (oldSavedSchedules) {
                    // Migrate from old format
                    schedules = JSON.parse(oldSavedSchedules);
                    cleanupWeekendRestDays();
                    // Save to new format
                    saveCurrentWeekSchedules();
                    // Remove old key
                    localStorage.removeItem('deepakFitnessSchedules');
                } else {
                    // Create default schedule - all days start empty
                    DAYS.forEach(day => {
                        schedules[day] = [];
                    });
                }
            }

            if (savedFavorites) {
                favorites = JSON.parse(savedFavorites);
            }
        }

        function cleanupWeekendRestDays() {
            // For all days, if they only have stretching, remove it (make them empty/rest days)
            DAYS.forEach(day => {
                const daySchedule = schedules[day] || [];
                // If only stretching exists, remove it
                if (daySchedule.length === 1 && daySchedule[0].exercise === 'Stretching') {
                    schedules[day] = [];
                }
                // If only stretching exists among multiple items, still check
                const nonStretchingExercises = daySchedule.filter(ex => ex.exercise !== 'Stretching');
                if (nonStretchingExercises.length === 0 && daySchedule.length > 0) {
                    schedules[day] = [];
                }
            });
            saveData(); // Save the cleaned up data
        }

        function cleanupAllSavedWeeks() {
            // One-time migration: Clean up stretching-only schedules from all saved weeks
            const migrationKey = 'deepakFitness_migration_v2';
            
            // Check if migration already done
            if (localStorage.getItem(migrationKey)) {
                return; // Already migrated
            }
            
            // Get all localStorage keys
            const allKeys = Object.keys(localStorage);
            const weekKeys = allKeys.filter(key => key.startsWith('deepakFitness_week_'));
            
            // Clean up each saved week
            weekKeys.forEach(weekKey => {
                try {
                    const weekData = JSON.parse(localStorage.getItem(weekKey));
                    let modified = false;
                    
                    DAYS.forEach(day => {
                        const daySchedule = weekData[day] || [];
                        // If only stretching exists, remove it
                        if (daySchedule.length === 1 && daySchedule[0].exercise === 'Stretching') {
                            weekData[day] = [];
                            modified = true;
                        } else if (daySchedule.length > 0) {
                            const nonStretchingExercises = daySchedule.filter(ex => ex.exercise !== 'Stretching');
                            if (nonStretchingExercises.length === 0) {
                                weekData[day] = [];
                                modified = true;
                            }
                        }
                    });
                    
                    // Save cleaned data back
                    if (modified) {
                        localStorage.setItem(weekKey, JSON.stringify(weekData));
                    }
                } catch (e) {
                    // Silently skip any errors in migration
                }
            });
            
            // Mark migration as complete
            localStorage.setItem(migrationKey, 'true');
        }

        function saveData() {
            // Save schedules for the current week being viewed
            saveCurrentWeekSchedules();
            // Also save favorites globally
            localStorage.setItem('deepakFitnessFavorites', JSON.stringify(favorites));
        }

        function renderDayButtons() {
            const container = document.getElementById('dayButtons');
            container.innerHTML = '';
            DAYS.forEach(day => {
                const btn = document.createElement('button');
                btn.className = `day-btn ${day === currentDay ? 'active' : ''}`;
                btn.textContent = day.slice(0, 3);
                
                // Simple click to select day
                let clickTimer = null;
                let longPressTriggered = false;
                
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (!longPressTriggered) {
                        selectDay(day);
                    }
                    longPressTriggered = false;
                });
                
                // Long press to show schedule (for mobile)
                btn.addEventListener('mousedown', (e) => {
                    longPressTriggered = false;
                    clickTimer = setTimeout(() => {
                        longPressTriggered = true;
                        showWeeklySchedule(day);
                    }, 500);
                });
                
                btn.addEventListener('touchstart', (e) => {
                    longPressTriggered = false;
                    clickTimer = setTimeout(() => {
                        longPressTriggered = true;
                        showWeeklySchedule(day);
                    }, 500);
                });
                
                btn.addEventListener('mouseup', () => {
                    clearTimeout(clickTimer);
                });
                
                btn.addEventListener('mouseleave', () => {
                    clearTimeout(clickTimer);
                });
                
                btn.addEventListener('touchend', (e) => {
                    clearTimeout(clickTimer);
                });
                
                // Double click to show schedule (for desktop)
                btn.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    showWeeklySchedule(day);
                });
                
                container.appendChild(btn);
            });
        }

        function selectDay(day) {
            currentDay = day;
            renderDayButtons();
            updateView();
        }

        function setupEventListeners() {
            document.getElementById('scheduleViewBtn').onclick = () => switchView('schedule');
            document.getElementById('workoutViewBtn').onclick = () => switchView('workout');
            document.getElementById('addExerciseBtn').onclick = openModal;
            document.getElementById('closeModalBtn').onclick = closeModal;
            document.getElementById('modalOverlay').onclick = (e) => {
                if (e.target === e.currentTarget) closeModal();
            };
            document.getElementById('modalAddBtn').onclick = addExercise;
            
            // Weekly schedule modal
            document.getElementById('closeScheduleModalBtn').onclick = closeWeeklySchedule;
            document.getElementById('scheduleModal').onclick = (e) => {
                if (e.target === e.currentTarget) closeWeeklySchedule();
            };

            // Category tabs
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.onclick = () => selectCategory(tab.dataset.category);
            });
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('scheduleViewBtn').classList.toggle('active', view === 'schedule');
            document.getElementById('workoutViewBtn').classList.toggle('active', view === 'workout');
            document.getElementById('scheduleView').classList.toggle('hidden', view !== 'schedule');
            document.getElementById('workoutView').classList.toggle('hidden', view !== 'workout');
            updateView();
        }

        function updateView() {
            if (currentView === 'schedule') {
                renderScheduleView();
            } else {
                renderWorkoutView();
            }
        }

        function renderScheduleView() {
            const daySchedule = schedules[currentDay] || [];
            const totalDuration = daySchedule.reduce((sum, ex) => sum + ex.duration, 0);
            const completionPercent = daySchedule.length > 0 
                ? Math.round((daySchedule.filter(ex => ex.completed).length / daySchedule.length) * 100)
                : 0;

            const isPastDay = isDayInPast(currentDay);
            const hasRealExercises = daySchedule.some(ex => ex.exercise !== 'Stretching');

            document.getElementById('dayTitle').textContent = `${currentDay}'s Workout`;
            document.getElementById('timeDisplay').textContent = `${totalDuration} / 60 min`;
            document.getElementById('completionPercent').textContent = `${completionPercent}%`;
            document.getElementById('progressFill').style.width = `${(totalDuration / 60) * 100}%`;

            const list = document.getElementById('exerciseList');
            list.innerHTML = '';
            
            // Show rest day message if schedule is empty
            if (daySchedule.length === 0) {
                const restMessage = document.createElement('div');
                restMessage.style.cssText = `
                    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
                    border-radius: 1rem;
                    padding: 2rem;
                    text-align: center;
                    color: #9ca3af;
                    border: 2px dashed #404040;
                `;
                
                const isWeekend = currentDay === 'Saturday' || currentDay === 'Sunday';
                const title = isWeekend ? 'Rest Day' : 'No Exercises Scheduled';
                const subtitle = isPastDay 
                    ? (isWeekend ? 'Rest day.' : 'No workout was scheduled.')
                    : (isWeekend ? 'Rest day. Click "Add Exercise" if you want to work out.' : 'Click "Add Exercise" to create a schedule.');
                
                restMessage.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">${isWeekend ? 'üò¥' : 'üìã'}</div>
                    <div style="font-size: 1.25rem; font-weight: 600; color: #e5e7eb; margin-bottom: 0.5rem;">${title}</div>
                    <div style="font-size: 0.875rem;">${subtitle}</div>
                `;
                list.appendChild(restMessage);
            } else {
                daySchedule.forEach(exercise => {
                    const item = createExerciseItem(exercise, isPastDay);
                    list.appendChild(item);
                });
            }

            // Simplified - just show/hide Add Exercise based on past/future
            const addBtn = document.getElementById('addExerciseBtn');
            
            if (isPastDay) {
                // Past day - hide Add Exercise (view only)
                addBtn.style.display = 'none';
            } else {
                // Today or future - show Add Exercise
                addBtn.style.display = 'flex';
            }
        }

        function createExerciseItem(exercise, isReadOnly = false) {
            const div = document.createElement('div');
            div.className = 'exercise-item';

            const categoryGradient = getCategoryClass(exercise.category);
            const isFav = favorites.includes(`${exercise.category}:${exercise.exercise}`);

            div.innerHTML = `
                <div class="exercise-left">
                    <div class="category-icon" style="background: ${categoryGradient};">
                        ${getCategoryIcon(exercise.category)}
                    </div>
                    <div>
                        <div class="exercise-name">${exercise.exercise}</div>
                        <div class="exercise-category">${exercise.category}</div>
                    </div>
                </div>
                <div class="exercise-right">
                    <div class="duration-badge">${exercise.duration} min</div>
                    ${!isReadOnly && exercise.exercise !== 'Stretching' ? `
                        <button class="icon-btn favorite ${isFav ? 'active' : ''}" onclick="toggleFavorite('${exercise.exercise}', '${exercise.category}')">
                            <svg class="medium-icon" viewBox="0 0 24 24">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                        </button>
                        <button class="icon-btn delete" onclick="removeExercise(${exercise.id})">
                            <svg class="medium-icon" style="stroke: #f87171;" viewBox="0 0 24 24">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    ` : ''}
                </div>
            `;

            return div;
        }

        function getCategoryIcon(category) {
            const icons = {
                'Arms': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>',
                'Chest': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>',
                'Back': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>',
                'Shoulders': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>',
                'Abs': '<svg class="small-icon" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>',
                'Legs': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>',
                'Butt/Hips': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>',
                'Cardio': '<svg class="small-icon" viewBox="0 0 24 24"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>',
                // Legacy support for backward compatibility
                'Core & Abs': '<svg class="small-icon" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>',
                cardio: '<svg class="small-icon" viewBox="0 0 24 24"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>',
                floor: '<svg class="small-icon" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>',
                strength: '<svg class="small-icon" viewBox="0 0 24 24"><path d="M14.4 14.4L9.6 9.6"></path><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"></path></svg>'
            };
            return icons[category] || icons['Cardio'];
        }

        function getCategoryClass(category) {
            // Premium gold accent for all categories
            return 'linear-gradient(135deg, #d4af37 0%, #c9a342 100%)';
        }

        function renderWorkoutView() {
            const daySchedule = schedules[currentDay] || [];
            const completionPercent = daySchedule.length > 0 
                ? Math.round((daySchedule.filter(ex => ex.completed).length / daySchedule.length) * 100)
                : 0;

            document.getElementById('workoutDayTitle').textContent = `${currentDay}'s Workout Session`;
            document.getElementById('workoutCompletionPercent').textContent = `${completionPercent}%`;
            document.getElementById('workoutCompletionText').textContent = 
                completionPercent === 100 ? 'üéâ Workout Complete!' : 'Keep Going!';

            const list = document.getElementById('workoutList');
            list.innerHTML = '';
            
            // Show rest day message if schedule is empty
            if (daySchedule.length === 0) {
                const restMessage = document.createElement('div');
                restMessage.style.cssText = `
                    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
                    border-radius: 1rem;
                    padding: 2rem;
                    text-align: center;
                    color: #9ca3af;
                    border: 2px dashed #404040;
                `;
                
                const isWeekend = currentDay === 'Saturday' || currentDay === 'Sunday';
                const title = isWeekend ? 'Rest Day' : 'No Exercises Scheduled';
                const subtitle = isWeekend ? 'Enjoy your rest!' : 'No workout scheduled for today.';
                
                restMessage.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">${isWeekend ? 'üò¥' : 'üìã'}</div>
                    <div style="font-size: 1.25rem; font-weight: 600; color: #e5e7eb; margin-bottom: 0.5rem;">${title}</div>
                    <div style="font-size: 0.875rem;">${subtitle}</div>
                `;
                list.appendChild(restMessage);
            } else {
                daySchedule.forEach(exercise => {
                    const item = createWorkoutItem(exercise);
                    list.appendChild(item);
                });
            }
        }

        function createWorkoutItem(exercise) {
            const div = document.createElement('div');
            div.className = `workout-item ${exercise.completed ? 'completed' : ''}`;
            div.onclick = () => toggleComplete(exercise.id);

            const categoryGradient = getCategoryClass(exercise.category);

            div.innerHTML = `
                <div class="checkbox ${exercise.completed ? 'checked' : ''}">
                    <svg class="large-icon" viewBox="0 0 24 24">
                        ${exercise.completed 
                            ? '<circle cx="12" cy="12" r="10"></circle><path d="m9 12 2 2 4-4"></path>'
                            : '<circle cx="12" cy="12" r="10"></circle>'}
                    </svg>
                </div>
                <div class="workout-info">
                    <div class="workout-name ${exercise.completed ? 'completed' : ''}">${exercise.exercise}</div>
                    <div class="workout-meta">${exercise.category} ‚Ä¢ ${exercise.duration} minutes</div>
                </div>
                <div class="category-icon" style="background: ${categoryGradient};">
                    ${getCategoryIcon(exercise.category)}
                </div>
            `;

            return div;
        }

        function toggleComplete(exerciseId) {
            const daySchedule = schedules[currentDay] || [];
            const exercise = daySchedule.find(ex => ex.id === exerciseId);
            if (exercise) {
                exercise.completed = !exercise.completed;
                saveData();
                renderWorkoutView();
                if (currentView === 'schedule') renderScheduleView();
            }
        }

        function toggleFavorite(exerciseName, category) {
            const favoriteKey = `${category}:${exerciseName}`;
            const index = favorites.indexOf(favoriteKey);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(favoriteKey);
            }
            saveData();
            
            // Refresh the exercise grid if modal is open
            const modalOverlay = document.getElementById('modalOverlay');
            if (modalOverlay && modalOverlay.classList.contains('show')) {
                renderExerciseGrid();
            }
            
            // Also refresh schedule view if visible
            if (currentView === 'schedule') {
                renderScheduleView();
            }
        }

        function removeExercise(exerciseId) {
            const daySchedule = schedules[currentDay] || [];
            const filtered = daySchedule.filter(ex => ex.id !== exerciseId && ex.exercise !== 'Stretching');
            
            // If no exercises left (for ANY day), make it empty
            if (filtered.length === 0) {
                schedules[currentDay] = [];
            } else {
                // Otherwise, keep stretching at the end
                schedules[currentDay] = [
                    ...filtered,
                    { id: Date.now(), exercise: 'Stretching', category: 'Abs', duration: 5, completed: false }
                ];
            }
            
            saveData();
            renderScheduleView();
        }

        function openModal() {
            // Complete reset every time
            selectedExercises = [];
            selectedExercise = '';
            selectedCategory = 'Favorites';
            
            // Reset duration to default
            const durationInput = document.getElementById('durationInput');
            if (durationInput) durationInput.value = 5;
            
            // Update UI elements with safety checks
            const modalDayName = document.getElementById('modalDayName');
            const selectedCount = document.getElementById('selectedCount');
            const addBtnText = document.getElementById('addBtnText');
            const modalAddBtn = document.getElementById('modalAddBtn');
            
            if (modalDayName) modalDayName.textContent = currentDay;
            if (selectedCount) selectedCount.textContent = '';
            if (addBtnText) addBtnText.textContent = `Add to ${currentDay}`;
            if (modalAddBtn) modalAddBtn.disabled = true;
            
            // Render fresh category and exercises
            selectCategory('Favorites');
            
            // Show modal
            document.getElementById('modalOverlay').classList.add('show');
        }

        function closeModal() {
            // Complete reset on close
            selectedExercises = [];
            selectedExercise = '';
            selectedCategory = 'Arms';
            
            // Hide modal
            document.getElementById('modalOverlay').classList.remove('show');
            
            // If we're editing a day in the Full Week View, refresh it
            if (editingDayInModal) {
                showWeeklySchedule();
            }
        }

        function showError(message) {
            // Create a custom error modal
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #ef4444, #dc2626);
                color: white;
                padding: 2rem;
                border-radius: 1rem;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                z-index: 100;
                max-width: 90%;
                width: 400px;
                text-align: center;
            `;
            
            const messageLines = message.split('\n');
            errorDiv.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">${messageLines[0]}</div>
                <div style="white-space: pre-line; line-height: 1.6; margin-bottom: 1.5rem;">${messageLines.slice(1).join('\n')}</div>
                <button onclick="this.parentElement.remove()" style="
                    background: white;
                    color: #ef4444;
                    border: none;
                    padding: 0.75rem 2rem;
                    border-radius: 0.5rem;
                    font-weight: 700;
                    font-size: 1rem;
                    cursor: pointer;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                ">Got It!</button>
            `;
            
            document.body.appendChild(errorDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        function showWeeklySchedule(startDay = null) {
            updateModalWeekDisplay();
            
            const modal = document.getElementById('scheduleModal');
            const content = document.getElementById('weeklyScheduleContent');
            
            content.innerHTML = '';
            
            // Always show all days in order
            DAYS.forEach(day => {
                const daySchedule = schedules[day] || [];
                const totalDuration = daySchedule.reduce((sum, ex) => sum + ex.duration, 0);
                const hasExercises = daySchedule.length > 0 && !(daySchedule.length === 1 && daySchedule[0].exercise === 'Stretching');
                
                // Check if THIS SPECIFIC DAY is in the past
                const isPastDay = isDayInPast(day);
                const isEditing = editingDayInModal === day;
                
                const dayCard = document.createElement('div');
                dayCard.className = `day-schedule-card ${isEditing ? 'editing-mode' : ''}`;
                dayCard.id = `day-card-${day}`;
                
                let exercisesHTML = '';
                if (!hasExercises) {
                    const isWeekend = day === 'Saturday' || day === 'Sunday';
                    const emptyMessage = isWeekend ? 'Rest day' : 'No exercises scheduled';
                    exercisesHTML = `<div class="empty-day">${emptyMessage}</div>`;
                } else {
                    exercisesHTML = daySchedule.map(ex => {
                        const catGradient = getCategoryClass(ex.category);
                        const deleteBtn = (!isPastDay && isEditing && ex.exercise !== 'Stretching') ? `
                            <button class="exercise-delete-btn" onclick="removeExerciseInModal('${day}', ${ex.id})">
                                <svg style="width: 1.25rem; height: 1.25rem; stroke: #ef4444;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M3 6h18"></path>
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </button>
                        ` : '';
                        
                        return `
                        <div class="day-schedule-exercise">
                            <div class="day-schedule-exercise-name">
                                <div class="category-icon" style="padding: 0.25rem; width: 1.5rem; height: 1.5rem; background: ${catGradient};">
                                    ${getCategoryIcon(ex.category)}
                                </div>
                                <span>${ex.exercise}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span class="day-schedule-exercise-duration">${ex.duration} min</span>
                                ${deleteBtn}
                            </div>
                        </div>
                    `}).join('');
                }
                
                // Add Exercise button for editing mode
                const addExerciseBtn = (!isPastDay && isEditing) ? `
                    <button class="inline-add-btn" onclick="openModalForDay('${day}')">
                        <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Exercise
                    </button>
                ` : '';
                
                // Determine button text and styling
                let buttonText = '';
                let buttonAction = '';
                let buttonClass = 'edit-day-btn';
                
                if (isPastDay) {
                    buttonText = 'View';
                    buttonAction = `toggleEditModeInModal('${day}')`;
                    buttonClass = 'edit-day-btn view-only';
                } else if (isEditing) {
                    buttonText = 'Done';
                    buttonAction = `toggleEditModeInModal('${day}')`;
                    buttonClass = 'edit-day-btn view-only';
                } else {
                    buttonText = hasExercises ? 'Edit' : 'Create';
                    buttonAction = `toggleEditModeInModal('${day}')`;
                    buttonClass = 'edit-day-btn';
                }
                
                dayCard.innerHTML = `
                    <div class="day-schedule-header">
                        <div>
                            <div class="day-schedule-name">${day}</div>
                            <div class="day-schedule-time">${totalDuration} / 60 min</div>
                        </div>
                        <button class="${buttonClass}" onclick="${buttonAction}">
                            <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                ${isPastDay ? 
                                    '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>' :
                                    isEditing ?
                                    '<polyline points="20 6 9 17 4 12"></polyline>' :
                                    '<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>'
                                }
                            </svg>
                            ${buttonText}
                        </button>
                    </div>
                    <div class="day-schedule-exercises">
                        ${exercisesHTML}
                    </div>
                    ${addExerciseBtn}
                `;
                
                content.appendChild(dayCard);
            });
            
            modal.classList.add('show');
        }

        function closeWeeklySchedule() {
            editingDayInModal = null; // Reset editing mode
            document.getElementById('scheduleModal').classList.remove('show');
        }

        function toggleEditModeInModal(day) {
            if (editingDayInModal === day) {
                // User clicked Done - exit editing mode
                editingDayInModal = null;
            } else {
                // User clicked Edit/Create - enter editing mode
                editingDayInModal = day;
            }
            // Refresh the modal to show new state
            showWeeklySchedule();
        }

        function openModalForDay(day) {
            // Set the day context
            currentDay = day;
            
            // Complete reset - exactly like openModal
            selectedExercises = [];
            selectedExercise = '';
            selectedCategory = 'Favorites';
            
            // Reset duration to default
            const durationInput = document.getElementById('durationInput');
            if (durationInput) durationInput.value = 5;
            
            // Update UI elements with safety checks
            const modalDayName = document.getElementById('modalDayName');
            const selectedCount = document.getElementById('selectedCount');
            const addBtnText = document.getElementById('addBtnText');
            const modalAddBtn = document.getElementById('modalAddBtn');
            
            if (modalDayName) modalDayName.textContent = currentDay;
            if (selectedCount) selectedCount.textContent = '';
            if (addBtnText) addBtnText.textContent = `Add to ${currentDay}`;
            if (modalAddBtn) modalAddBtn.disabled = true;
            
            // Render fresh category and exercises
            selectCategory('Favorites');
            
            // Show modal
            document.getElementById('modalOverlay').classList.add('show');
        }

        function removeExerciseInModal(day, exerciseId) {
            // Temporarily set currentDay to the day being edited
            const originalDay = currentDay;
            currentDay = day;
            
            // Remove the exercise
            removeExercise(exerciseId);
            
            // Restore original currentDay
            currentDay = originalDay;
            
            // Refresh the Full Week View
            showWeeklySchedule();
        }

        function changeWeekInModal(direction) {
            // Change week while in the modal
            changeWeek(direction);
            // Refresh the modal content
            showWeeklySchedule();
        }

        function updateModalWeekDisplay() {
            const weekStart = getWeekStart(todayDate);
            weekStart.setDate(weekStart.getDate() + (currentWeekOffset * 7));
            const weekEnd = getWeekEnd(weekStart);
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const currentWeekStart = getWeekStart(today);
            currentWeekStart.setHours(0, 0, 0, 0);
            weekStart.setHours(0, 0, 0, 0);
            
            // Determine week status
            let statusText = '';
            let statusClass = '';
            
            if (weekStart.getTime() === currentWeekStart.getTime()) {
                statusText = 'This Week';
                statusClass = 'week-status-current';
            } else if (weekStart < currentWeekStart) {
                const weeksAgo = Math.abs(currentWeekOffset);
                statusText = weeksAgo === 1 ? 'Last Week' : `${weeksAgo} Weeks Ago`;
                statusClass = 'week-status-past';
            } else {
                const weeksAhead = currentWeekOffset;
                statusText = weeksAhead === 1 ? 'Next Week' : `${weeksAhead} Weeks Ahead`;
                statusClass = 'week-status-future';
            }
            
            // Update modal badge and date
            const modalBadge = document.getElementById('modalWeekStatusBadge');
            modalBadge.textContent = statusText;
            modalBadge.className = `week-status-badge ${statusClass}`;
            
            document.getElementById('modalWeekDisplayRange').textContent = 
                `${formatDate(weekStart)} - ${formatDate(weekEnd)}, ${weekStart.getFullYear()}`;
        }

        function goToHome() {
            // Save current week before changing
            saveCurrentWeekSchedules();
            
            // Reset to current week (offset 0)
            currentWeekOffset = 0;
            
            // Load current week's schedules
            schedules = getCurrentWeekSchedules();
            
            // Set to today's day
            setCurrentDayFromCalendar();
            
            // Update all displays
            updateWeekDisplay();
            renderDayButtons();
            
            // Close the weekly schedule modal if it's open
            closeWeeklySchedule();
            
            // Switch to manage schedule view (the main homepage)
            switchView('schedule');
            
            // Update the view
            updateView();
            
            // Scroll to top of page
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function selectCategory(category) {
            selectedCategory = category;
            document.querySelectorAll('.category-tab').forEach(tab => {
                const isActive = tab.dataset.category === category;
                tab.classList.toggle('active', isActive);
                
                // Premium gold for active, dark for inactive
                if (isActive) {
                    tab.style.background = 'linear-gradient(135deg, #d4af37 0%, #c9a342 100%)';
                    tab.style.color = '#000000';
                    tab.style.borderColor = '#d4af37';
                } else {
                    tab.style.background = '#2d2d2d';
                    tab.style.color = '#e5e7eb';
                    tab.style.borderColor = '#404040';
                }
            });
            renderExerciseGrid();
        }

        function renderExerciseGrid() {
            const grid = document.getElementById('exerciseGrid');
            grid.innerHTML = '';

            let exercisesToShow = [];
            
            if (selectedCategory === 'Favorites') {
                // Build list of all favorited exercises from all categories
                const favExercises = [];
                
                Object.keys(EXERCISE_LIBRARY).forEach(category => {
                    EXERCISE_LIBRARY[category].forEach(ex => {
                        const favoriteKey = `${category}:${ex.name}`;
                        if (favorites.includes(favoriteKey)) {
                            favExercises.push({
                                ...ex,
                                category: category,
                                isFav: true
                            });
                        }
                    });
                });
                
                // Sort by category first, then alphabetically within category
                exercisesToShow = favExercises.sort((a, b) => {
                    if (a.category !== b.category) {
                        return a.category.localeCompare(b.category);
                    }
                    return a.name.localeCompare(b.name);
                });
                
                // Show empty state if no favorites
                if (exercisesToShow.length === 0) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 3rem 1rem; color: #9ca3af;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚≠ê</div>
                            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: #e5e7eb;">No Favorites Yet</div>
                            <div style="font-size: 0.875rem;">Tap the star icon on any exercise to add it to your favorites.</div>
                        </div>
                    `;
                    return;
                }
            } else {
                // Regular category view
                const exercises = EXERCISE_LIBRARY[selectedCategory] || [];
                exercisesToShow = exercises.map(ex => ({
                    ...ex,
                    category: selectedCategory,
                    isFav: favorites.includes(`${selectedCategory}:${ex.name}`)
                })).sort((a, b) => {
                    if (a.isFav && !b.isFav) return -1;
                    if (!a.isFav && b.isFav) return 1;
                    return 0;
                });
            }

            const categoryGradient = getCategoryClass(selectedCategory);

            // Render exercises (works for both Favorites and regular categories)
            let lastCategory = null;
            exercisesToShow.forEach(item => {
                // Add category header for Favorites view
                if (selectedCategory === 'Favorites' && item.category !== lastCategory) {
                    const categoryHeader = document.createElement('div');
                    categoryHeader.style.cssText = `
                        padding: 1rem 0.5rem 0.5rem;
                        font-size: 0.75rem;
                        font-weight: 700;
                        color: #d4af37;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        margin-top: ${lastCategory ? '1rem' : '0'};
                    `;
                    categoryHeader.textContent = item.category;
                    grid.appendChild(categoryHeader);
                    lastCategory = item.category;
                }
                
                const isSelected = isExerciseSelected(item.name, item.category);
                
                const btn = document.createElement('button');
                btn.className = `exercise-option ${isSelected ? 'selected' : ''}`;
                btn.onclick = () => toggleExerciseSelection(item.name, item.category);
                
                const initial = item.name.charAt(0).toUpperCase();
                const itemCategoryGradient = getCategoryClass(item.category);
                
                btn.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem; flex: 1; min-width: 0;">
                        <div style="position: relative; width: 70px; height: 70px; flex-shrink: 0;">
                            <img src="${item.img}" 
                                 alt="${item.name}" 
                                 style="width: 100%; height: 100%; object-fit: cover; border-radius: 0.5rem; display: block;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; position: absolute; inset: 0; background: ${itemCategoryGradient}; border-radius: 0.5rem; align-items: center; justify-content: center; font-size: 1.75rem; font-weight: 700; color: white;">
                                ${initial}
                            </div>
                        </div>
                        <div style="text-align: left; flex: 1; min-width: 0; overflow: hidden;">
                            <div style="font-weight: 700; font-size: 0.95rem; margin-bottom: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.name}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.muscles}${selectedCategory === 'Favorites' ? ' ‚Ä¢ ' + item.category : ''}</div>
                        </div>
                    </div>
                    <div class="exercise-badges" style="flex-shrink: 0; display: flex; align-items: center; gap: 0.5rem;">
                        <button onclick="event.stopPropagation(); toggleFavorite('${item.name}', '${item.category}')" style="background: none; border: none; padding: 0; cursor: pointer; display: flex;">
                            <svg style="width: 1.25rem; height: 1.25rem; ${item.isFav ? 'fill: #facc15; stroke: #facc15;' : 'fill: none; stroke: #6b7280;'}" viewBox="0 0 24 24">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                        </button>
                        ${isSelected ? 
                            '<div style="width: 24px; height: 24px; background: linear-gradient(135deg, #d4af37, #c9a342); border-radius: 4px; display: flex; align-items: center; justify-content: center;"><svg style="width: 16px; height: 16px; stroke: #000;" fill="none" stroke-width="3" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg></div>' : 
                            '<div style="width: 24px; height: 24px; border: 2px solid #404040; border-radius: 4px;"></div>'
                        }
                    </div>
                `;
                
                grid.appendChild(btn);
            });
        }

        function toggleExerciseSelection(exerciseName, category) {
            const exerciseKey = `${category}:${exerciseName}`;
            const index = selectedExercises.findIndex(ex => ex.key === exerciseKey);
            
            if (index > -1) {
                // Deselect
                selectedExercises.splice(index, 1);
            } else {
                // Select - get default duration
                const duration = parseInt(document.getElementById('durationInput').value) || 5;
                selectedExercises.push({
                    key: exerciseKey,
                    name: exerciseName,
                    category: category,
                    duration: duration
                });
            }
            
            updateSelectedCount();
            document.getElementById('modalAddBtn').disabled = selectedExercises.length === 0;
            renderExerciseGrid();
        }

        function updateSelectedCount() {
            const countEl = document.getElementById('selectedCount');
            const btnTextEl = document.getElementById('addBtnText');
            const dayName = currentDay;
            
            // Defensive checks
            if (!countEl || !btnTextEl) return;
            
            if (selectedExercises.length === 0) {
                countEl.textContent = '';
                btnTextEl.textContent = `Add to ${dayName}`;
            } else {
                countEl.textContent = `(${selectedExercises.length} selected)`;
                btnTextEl.textContent = `Add ${selectedExercises.length} exercise${selectedExercises.length > 1 ? 's' : ''} to ${dayName}`;
            }
        }

        function isExerciseSelected(exerciseName, category) {
            const exerciseKey = `${category}:${exerciseName}`;
            return selectedExercises.some(ex => ex.key === exerciseKey);
        }

        function addExercise() {
            if (selectedExercises.length === 0) return;

            const daySchedule = schedules[currentDay] || [];
            const withoutStretching = daySchedule.filter(ex => ex.exercise !== 'Stretching');
            
            // Check for duplicates in the batch
            const duplicates = selectedExercises.filter(selected => 
                daySchedule.some(ex => ex.exercise === selected.name)
            );
            
            if (duplicates.length > 0) {
                const duplicateNames = duplicates.map(d => d.name).join(', ');
                showDuplicateConfirmation(duplicateNames, duplicates, selectedExercises);
                return;
            }

            // Calculate total time needed
            const selectedTotalTime = selectedExercises.reduce((sum, ex) => sum + ex.duration, 0);
            const currentTotal = daySchedule.reduce((sum, ex) => sum + ex.duration, 0);
            const currentWithoutStretching = currentTotal - (daySchedule.some(ex => ex.exercise === 'Stretching') ? 5 : 0);
            
            if (currentWithoutStretching + selectedTotalTime > 55) {
                const availableTime = 55 - currentWithoutStretching;
                showError(`‚è±Ô∏è Time Limit Exceeded!\n\nYou're trying to add ${selectedTotalTime} minutes, but you only have ${availableTime} minutes available.\n\nCurrent total: ${currentWithoutStretching} minutes\nStretching: 5 minutes\nSelected exercises: ${selectedTotalTime} minutes\nAvailable: ${availableTime} minutes\n\nPlease remove some exercises or reduce durations.`);
                return;
            }

            // Add all selected exercises
            proceedWithAddMultipleExercises(selectedExercises, daySchedule, withoutStretching);
        }

        function proceedWithAddMultipleExercises(exercisesToAdd, daySchedule, withoutStretching) {
            const isRestDay = daySchedule.length === 0;
            
            // Create new exercise objects
            const newExercises = exercisesToAdd.map((ex, index) => ({
                id: Date.now() + index,
                exercise: ex.name,
                category: ex.category,
                duration: ex.duration,
                completed: false
            }));

            const stretching = {
                id: Date.now() + exercisesToAdd.length + 1,
                exercise: 'Stretching',
                category: 'Abs',
                duration: 5,
                completed: false
            };

            // Add all exercises with stretching at the end
            schedules[currentDay] = [...withoutStretching, ...newExercises, stretching];

            saveData();
            closeModal();
            renderScheduleView();
        }

        function showDuplicateConfirmation(displayNames, duplicates, allSelected) {
            // Store globally instead of passing through onclick
            pendingDuplicateAdd = allSelected;
            
            const confirmDiv = document.createElement('div');
            confirmDiv.id = 'duplicateConfirmDialog';
            confirmDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
                color: white;
                padding: 2rem;
                border-radius: 1rem;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                z-index: 100;
                max-width: 90%;
                width: 400px;
                text-align: center;
                border: 1px solid #d4af37;
            `;
            
            const message = duplicates.length === 1 
                ? `<strong>"${displayNames}"</strong> is already in your ${currentDay} schedule.`
                : `The following exercises are already in your ${currentDay} schedule:<br><strong>${displayNames}</strong>`;
            
            confirmDiv.innerHTML = `
                <div style="font-size: 2.5rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                <div style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; color: #d4af37;">Duplicate Exercise${duplicates.length > 1 ? 's' : ''}</div>
                <div style="line-height: 1.6; margin-bottom: 1.5rem; color: #e5e7eb;">
                    ${message}<br><br>
                    Add ${duplicates.length > 1 ? 'them' : 'it'} again?
                </div>
                <div style="display: flex; gap: 0.75rem;">
                    <button onclick="cancelDuplicateAdd()" style="
                        flex: 1;
                        background: #2d2d2d;
                        border: 1px solid #404040;
                        color: #e5e7eb;
                        padding: 0.75rem;
                        border-radius: 0.5rem;
                        font-weight: 600;
                        font-size: 1rem;
                        cursor: pointer;
                    ">Cancel</button>
                    <button onclick="confirmAddDuplicates()" style="
                        flex: 1;
                        background: linear-gradient(135deg, #d4af37, #c9a342);
                        border: none;
                        color: #000000;
                        padding: 0.75rem;
                        border-radius: 0.5rem;
                        font-weight: 700;
                        font-size: 1rem;
                        cursor: pointer;
                    ">Yes, Add</button>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
        }

        function cancelDuplicateAdd() {
            const dialog = document.getElementById('duplicateConfirmDialog');
            if (dialog) dialog.remove();
            pendingDuplicateAdd = null;
        }

        function confirmAddDuplicates() {
            const dialog = document.getElementById('duplicateConfirmDialog');
            if (dialog) dialog.remove();
            
            if (!pendingDuplicateAdd) return;
            
            const daySchedule = schedules[currentDay] || [];
            const withoutStretching = daySchedule.filter(ex => ex.exercise !== 'Stretching');
            
            // Proceed with adding all selected exercises
            proceedWithAddMultipleExercises(pendingDuplicateAdd, daySchedule, withoutStretching);
            
            pendingDuplicateAdd = null;
        }

        // Start the app
        init();

        // Auto-save when page loses focus (user switches tabs/apps)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                saveCurrentWeekSchedules();
            }
        });

        // Auto-save when page is about to unload
        window.addEventListener('beforeunload', () => {
            saveCurrentWeekSchedules();
        });

        // Auto-save every 10 seconds as backup
        setInterval(() => {
            saveCurrentWeekSchedules();
        }, 10000);
    </script>
</body>
</html>